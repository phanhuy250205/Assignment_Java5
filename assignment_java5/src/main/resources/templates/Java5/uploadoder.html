<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quản lý sản phẩm - TechZone</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../../static/css/form/uploadoder.css">
</head>
<body>
<div class="container py-5">
    <div class="row">
        <div class="col-12">
            <div class="card shadow-sm border-0">
                <div class="card-body p-4">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h2 class="fw-bold m-0">Quản lý sản phẩm</h2>
                        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addProductModal">
                            <i class="fas fa-plus me-2"></i>Thêm sản phẩm mới
                        </button>
                    </div>

                    <!-- Bảng sản phẩm -->
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                            <tr>
                                <th>ID</th>
                                <th>Hình ảnh</th>
                                <th>Tên sản phẩm</th>
                                <th>Danh mục</th>
                                <th>Giá</th>
                                <th>Kho</th>
                                <th>Trạng thái</th>
                                <th>Thao tác</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr th:each="sanPham : ${sanPhams}" >
                                <td th:text="'#' + ${sanPham.id}"></td>
                                <td>
                                    <img src="./assets/img/iphone-15.jpg" alt="iPhone 15" class="product-img">
                                </td>
                                <td th:text="${sanPham.tensanpham}"></td>
                                <td th:text="${sanPham.phanLoaiHang.tenPhanLoai}"></td>
                                <td th:text="${#numbers.formatDecimal(sanPham.gia, 0, 'COMMA', 0, 'POINT')} + '₫'"></td>
                                <td th:text="${sanPham.soLuong}"></td>
                                <td><span th:classappend="${sanPham.trangThai == 'Còn hàng' ? 'badge bg-success' : (sanPham.trangThai == 'Hết hàng' ? 'badge bg-danger' : 'badge bg-secondary')}" th:text="${sanPham.trangThai}"></span>
                                </td></td>
                                <td>
                                    <div class="btn-group">
                                        <button class="btn btn-sm btn-outline-primary" data-bs-toggle="modal" data-bs-target="#editProductModal">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <!-- ✅ Nút xóa sản phẩm -->
                                        <a th:href="@{/api/sanpham/delete/{id}(id=${sanPham.id})}" class="btn btn-sm btn-outline-danger"
                                           onclick="return confirm('Bạn có chắc chắn muốn xóa sản phẩm này không?')">
                                            <i class="fas fa-trash"></i>
                                        </a>
                                    </div>
                                </td>
                            </tr>
                            <!-- Thêm các sản phẩm khác -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal Thêm sản phẩm -->
<div class="modal fade" id="addProductModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title fw-bold">Thêm sản phẩm mới</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="addProductForm" method="POST" action="/api/sanpham/create" enctype="multipart/form-data">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label class="form-label">Tên sản phẩm</label>
                            <input type="text" class="form-control" name="tensanpham" required>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Danh mục</label>
                            <select class="form-select" name="phanLoaiId" required>
                                <option value="">-- Chọn danh mục --</option>
                                <option th:each="danhMuc : ${danhMucList}"
                                        th:value="${danhMuc.id}"
                                        th:text="${danhMuc.tenPhanLoai}"></option>
                            </select>

                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Giá bán</label>
                            <input type="number" class="form-control" name="gia" required>
                        </div>
<!--                        <div class="col-md-6">-->
<!--                            <label class="form-label">Giá gốc</label>-->
<!--                            <input type="number" class="form-control" name="giaGoc">-->
<!--                        </div>-->
                        <div class="col-md-6">
                            <label class="form-label">Số lượng kho</label>
                            <input type="number" class="form-control" name="soLuong" required>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Trạng thái</label>
                            <select class="form-select" name="trangThai">
                                <option>Còn hàng</option>
                                <option>Hết hàng</option>
                                <option>Ngừng kinh doanh</option>
                            </select>
                        </div>
                        <div class="col-12">
                            <label class="form-label">Mô tả ngắn</label>
                            <textarea class="form-control" name="mota" rows="3"></textarea>
                        </div>

                        <div class="col-12">
                            <label class="form-label">Hình ảnh sản phẩm</label>
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label class="form-label">Ảnh chính</label>
                                    <input type="file" name="files" accept="image/*" class="form-control" id="mainImage">
                                    <img id="mainImagePreview" class="image-preview mt-2 d-none" width="150">
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Ảnh mặt trước</label>
                                    <input type="file" name="files" accept="image/*" class="form-control" id="frontImage">
                                    <img id="frontImagePreview" class="image-preview mt-2 d-none" width="150">
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Ảnh mặt sau</label>
                                    <input type="file" name="files" accept="image/*" class="form-control" id="backImage">
                                    <img id="backImagePreview" class="image-preview mt-2 d-none" width="150">
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Ảnh chi tiết</label>
                                    <input type="file" name="files" accept="image/*" class="form-control" id="detailImage">
                                    <img id="detailImagePreview" class="image-preview mt-2 d-none" width="150">
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                <button type="submit" class="btn btn-primary" form="addProductForm">Lưu sản phẩm</button>
            </div>
        </div>
    </div>
</div>


<!-- Modal Sửa sản phẩm - Tương tự như modal thêm -->

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
    // Hàm xử lý preview ảnh
    function handleImagePreview(inputId, previewId) {
        const input = document.getElementById(inputId);
        const preview = document.getElementById(previewId);

        input.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file && file.type.startsWith('image/')) {
                const reader = new FileReader();

                reader.onload = function(e) {
                    preview.innerHTML = `
                            <div class="image-preview-item position-relative">
                                <img src="${e.target.result}" class="img-fluid rounded" alt="Preview">
                                <button type="button" class="btn btn-danger btn-sm position-absolute top-0 end-0 m-1"
                                        onclick="clearImage('${inputId}', '${previewId}')">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        `;
                };

                reader.readAsDataURL(file);
            }
        });
    }

    // Hàm xóa ảnh
    function clearImage(inputId, previewId) {
        document.getElementById(inputId).value = '';
        document.getElementById(previewId).innerHTML = '';
    }

    // Khởi tạo preview cho tất cả input
    handleImagePreview('mainImage', 'mainImagePreview');
    handleImagePreview('frontImage', 'frontImagePreview');
    handleImagePreview('backImage', 'backImagePreview');
    handleImagePreview('detailImage', 'detailImagePreview');
</script>
</body>
<style>
    .product-img {
        width: 50px;
        height: 50px;
        object-fit: cover;
        border-radius: 5px;
    }
</style>
</html>
